<div class="container mx-auto p-6 max-w-6xl">
  <form [formGroup]="logForm" (ngSubmit)="onSubmit()" class="space-y-6">
    <!-- Page Header with Nutrition Score -->
    <div class="bg-white rounded-lg shadow-lg p-6">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-3xl font-display font-bold text-cream-900 mb-2">
            –î–Ω–µ–≤–Ω–∏–∫ –Ω–∞ {{ today }}
          </h1>
          <p class="text-cream-700">–û—Ç—Å–ª–µ–∂–∏–≤–∞–π —Å–∏–º–ø—Ç–æ–º—ã, –¥–æ–±–∞–≤–∫–∏ –∏ –ø–∏—Ç–∞–Ω–∏–µ</p>
        </div>
        <div class="text-center">
          <div class="flex items-center justify-center gap-2 mb-1">
            <ng-icon name="heroSparkles" size="24" style="color: var(--color-brand-600)" />
            <span class="text-4xl font-bold text-brand-600">{{ nutritionScore() }}</span>
          </div>
          <p class="text-sm text-cream-700 font-semibold">–ë–∞–ª–ª—ã –ü–∏—Ç–∞–Ω–∏—è</p>
        </div>
      </div>
    </div>

    <!-- Nutrition Tracking Section -->
    <div formGroupName="habits" class="bg-white rounded-lg shadow-lg p-6">
      <h2 class="text-2xl font-display font-bold text-cream-900 mb-4 flex items-center gap-2">
        <ng-icon name="heroBeaker" size="28" style="color: var(--color-brand-600)" />
        –ü—Ä–∏–≤—ã—á–∫–∏ –ü–∏—Ç–∞–Ω–∏—è
      </h2>

      <!-- Boolean Habits Checklist -->
      <div class="mb-6">
        <h3 class="text-lg font-semibold text-cream-800 mb-3">–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –ü—Ä–∏–≤—ã—á–∫–∏</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          @for (habit of booleanHabits; track habit.id) {
          <label
            class="flex items-start gap-3 p-3 rounded-lg border border-cream-300 hover:bg-cream-50 cursor-pointer transition-colors"
          >
            <input
              type="checkbox"
              [formControlName]="habit.id"
              class="mt-1 h-5 w-5 rounded text-brand-600 focus:ring-brand-500"
            />
            <div class="flex-1">
              <span class="text-cream-900 font-medium">{{ habit.title }}</span>
              <span class="ml-2 text-xs text-cream-600 font-semibold">({{ habit.weight }} –±)</span>
            </div>
          </label>
          }
        </div>
      </div>

      <!-- Counter Habits -->
      <div class="mb-6">
        <h3 class="text-lg font-semibold text-cream-800 mb-3">–°—á—ë—Ç—á–∏–∫–∏</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          @for (habit of counterHabits; track habit.id) {
          <div class="p-4 rounded-lg border border-cream-300 bg-cream-50">
            <div class="flex items-center justify-between mb-2">
              <span class="text-cream-900 font-medium">{{ habit.title }}</span>
              <span class="text-xs text-cream-600 font-semibold">({{ habit.weight }} –±)</span>
            </div>
            <div class="flex items-center gap-3">
              <button
                type="button"
                (click)="decrementCounter(habit.id)"
                class="w-10 h-10 rounded-full bg-cream-300 hover:bg-cream-400 text-cream-900 font-bold text-xl transition-colors"
              >
                ‚àí
              </button>
              <div class="flex-1 text-center">
                <div class="text-3xl font-bold text-brand-600">{{ getHabitValue(habit.id) }}</div>
                @if (habit.target) {
                <div class="text-sm text-cream-600">/ {{ habit.target }}</div>
                }
              </div>
              <button
                type="button"
                (click)="incrementCounter(habit.id)"
                class="w-10 h-10 rounded-full bg-brand-600 hover:bg-brand-700 text-white font-bold text-xl transition-colors"
              >
                +
              </button>
            </div>
            <!-- Progress Bar -->
            @if (habit.target) {
            <div class="mt-3 bg-cream-300 rounded-full h-2 overflow-hidden">
              <div
                class="bg-brand-600 h-2 transition-all duration-300"
                [style.width.%]="(getHabitValue(habit.id) / habit.target) * 100"
              ></div>
            </div>
            }
          </div>
          }
        </div>
      </div>

      <!-- Contextual Tips Card -->
      @if (contextualTips().length > 0) {
      <div class="bg-brand-50 border-l-4 border-brand-500 p-4 rounded">
        <div class="flex items-start gap-3">
          <ng-icon name="heroLightBulb" size="24" style="color: var(--color-brand-700)" />
          <div class="flex-1">
            <h4 class="font-semibold text-brand-900 mb-2">üí° –ü–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è —Ç–µ–±—è:</h4>
            <ul class="space-y-2">
              @for (tip of contextualTips(); track tip.id) {
              <li class="text-sm text-brand-800">‚Ä¢ {{ tip.text }}</li>
              }
            </ul>
          </div>
        </div>
      </div>
      }
    </div>

    <!-- Symptoms Section -->
    <div formGroupName="symptoms" class="bg-white rounded-lg shadow-lg p-6">
      <h2 class="text-2xl font-display font-bold text-cream-900 mb-4">–ö–∞–∫ —Ç—ã —Å–µ–±—è —á—É–≤—Å—Ç–≤—É–µ—à—å?</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Digestion Slider -->
        <div>
          <label for="digestion" class="block text-sm font-medium text-cream-800 mb-2"
            >–ü–∏—â–µ–≤–∞—Ä–µ–Ω–∏–µ (1-5)</label
          >
          <input
            id="digestion"
            type="range"
            min="1"
            max="5"
            formControlName="digestion"
            class="w-full h-2 bg-cream-200 rounded-lg appearance-none cursor-pointer accent-brand-600"
          />
          <div class="flex justify-between text-xs text-cream-600 mt-1">
            <span>–ü–ª–æ—Ö–æ</span>
            <span>–û—Ç–ª–∏—á–Ω–æ</span>
          </div>
        </div>
        <!-- Bloating Slider -->
        <div>
          <label for="bloating" class="block text-sm font-medium text-cream-800 mb-2"
            >–í–∑–¥—É—Ç–∏–µ (1-5)</label
          >
          <input
            id="bloating"
            type="range"
            min="1"
            max="5"
            formControlName="bloating"
            class="w-full h-2 bg-cream-200 rounded-lg appearance-none cursor-pointer accent-brand-600"
          />
          <div class="flex justify-between text-xs text-cream-600 mt-1">
            <span>–°–∏–ª—å–Ω–æ–µ</span>
            <span>–ù–µ—Ç</span>
          </div>
        </div>
        <!-- Energy Slider -->
        <div>
          <label for="energy" class="block text-sm font-medium text-cream-800 mb-2"
            >–≠–Ω–µ—Ä–≥–∏—è (1-5)</label
          >
          <input
            id="energy"
            type="range"
            min="1"
            max="5"
            formControlName="energy"
            class="w-full h-2 bg-cream-200 rounded-lg appearance-none cursor-pointer accent-brand-600"
          />
          <div class="flex justify-between text-xs text-cream-600 mt-1">
            <span>–ù–∏–∑–∫–∞—è</span>
            <span>–í—ã—Å–æ–∫–∞—è</span>
          </div>
        </div>
        <!-- Sleep Slider -->
        <div>
          <label for="sleep" class="block text-sm font-medium text-cream-800 mb-2"
            >–ö–∞—á–µ—Å—Ç–≤–æ –°–Ω–∞ (1-5)</label
          >
          <input
            id="sleep"
            type="range"
            min="1"
            max="5"
            formControlName="sleep"
            class="w-full h-2 bg-cream-200 rounded-lg appearance-none cursor-pointer accent-brand-600"
          />
          <div class="flex justify-between text-xs text-cream-600 mt-1">
            <span>–ü–ª–æ—Ö–æ–π</span>
            <span>–û—Ç–ª–∏—á–Ω—ã–π</span>
          </div>
        </div>
        <!-- Skin/Eye Puffiness Slider -->
        <div class="md:col-span-2">
          <label for="skinEyePuffiness" class="block text-sm font-medium text-cream-800 mb-2"
            >–û—Ç—ë—á–Ω–æ—Å—Ç—å –ö–æ–∂–∏/–ì–ª–∞–∑ (1-5)</label
          >
          <input
            id="skinEyePuffiness"
            type="range"
            min="1"
            max="5"
            formControlName="skinEyePuffiness"
            class="w-full h-2 bg-cream-200 rounded-lg appearance-none cursor-pointer accent-brand-600"
          />
          <div class="flex justify-between text-xs text-cream-600 mt-1">
            <span>–°–∏–ª—å–Ω–∞—è</span>
            <span>–ù–µ—Ç</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Supplements Section -->
    <div formGroupName="supplements" class="bg-white rounded-lg shadow-lg p-6">
      <h2 class="text-2xl font-display font-bold text-cream-900 mb-6">–î–æ–±–∞–≤–∫–∏ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é</h2>
      
      <!-- Morning Supplements -->
      @if (morningSupplements.length > 0) {
        <div class="mb-6">
          <h3 class="text-lg font-semibold text-cream-900 mb-3 flex items-center gap-2">
            <ng-icon name="heroSun" size="20" style="color: rgb(234 179 8)"></ng-icon>
            –£—Ç—Ä–æ (—Å –∑–∞–≤—Ç—Ä–∞–∫–æ–º)
          </h3>

          <!-- TODO: FIX THIS -->
          <div class="space-y-3">
            @for (supplement of morningSupplements; track $index) {
              @let product = getProduct(supplement.productId);
              @if (product) {
                <label
                  class="flex items-start gap-3 p-3 rounded-lg border border-cream-300 hover:border-brand-400 cursor-pointer transition-all"
                  [class.bg-brand-50/30]="logForm.get('supplements')?.get(getSupplementControlName(supplement, $index))?.value"
                  [class.border-brand-500]="logForm.get('supplements')?.get(getSupplementControlName(supplement, $index))?.value"
                >
                  <!-- Checkbox -->
                  <input
                    type="checkbox"
                    [formControlName]="getSupplementControlName(supplement, $index)"
                    class="mt-1 h-5 w-5 rounded text-brand-600 focus:ring-brand-500 flex-shrink-0"
                  />
                  
                  <!-- Product Image -->
                  <img
                    [src]="imageService.getProductImage(product.imageURL || '', { width: 60, height: 60, quality: 85 })"
                    [alt]="product.name"
                    class="w-12 h-12 object-contain rounded-lg bg-white flex-shrink-0"
                  />
                  
                  <!-- Product Info -->
                  <div class="flex-grow min-w-0">
                    <div class="font-semibold text-cream-900">{{ product.name }}</div>
                    <div class="text-sm text-cream-700">
                      {{ supplement.amount }}
                      @if (supplement.notes) {
                        <span class="text-cream-600"> ¬∑ {{ supplement.notes }}</span>
                      }
                    </div>
                  </div>
                </label>
              }
            }
          </div>
        </div>
      }

      <!-- Lunch Supplements -->
      @if (lunchSupplements.length > 0) {
        <div class="mb-6">
          <h3 class="text-lg font-semibold text-cream-900 mb-3 flex items-center gap-2">
            <ng-icon name="heroFire" size="20" style="color: rgb(234 88 12)"></ng-icon>
            –û–±–µ–¥
          </h3>
          <div class="space-y-3">
            @for (supplement of lunchSupplements; track $index) {
              @let product = getProduct(supplement.productId);
              @if (product) {
                <label
                  class="flex items-start gap-3 p-3 rounded-lg border border-cream-300 hover:border-brand-400 cursor-pointer transition-all"
                  [class.bg-brand-50/30]="logForm.get('supplements')?.get(getSupplementControlName(supplement, $index))?.value"
                  [class.border-brand-500]="logForm.get('supplements')?.get(getSupplementControlName(supplement, $index))?.value"
                >
                  <!-- Checkbox -->
                  <input
                    type="checkbox"
                    [formControlName]="getSupplementControlName(supplement, $index)"
                    class="mt-1 h-5 w-5 rounded text-brand-600 focus:ring-brand-500 flex-shrink-0"
                  />
                  
                  <!-- Product Image -->
                  <img
                    [src]="imageService.getProductImage(product.imageURL || '', { width: 60, height: 60, quality: 85 })"
                    [alt]="product.name"
                    class="w-12 h-12 object-contain rounded-lg bg-white flex-shrink-0"
                  />
                  
                  <!-- Product Info -->
                  <div class="flex-grow min-w-0">
                    <div class="font-semibold text-cream-900">{{ product.name }}</div>
                    <div class="text-sm text-cream-700">
                      {{ supplement.amount }}
                      @if (supplement.notes) {
                        <span class="text-cream-600"> ¬∑ {{ supplement.notes }}</span>
                      }
                    </div>
                  </div>
                </label>
              }
            }
          </div>
        </div>
      }

      <!-- Dinner Supplements -->
      @if (dinnerSupplements.length > 0) {
        <div>
          <h3 class="text-lg font-semibold text-cream-900 mb-3 flex items-center gap-2">
            <ng-icon name="heroMoon" size="20" style="color: rgb(79 70 229)"></ng-icon>
            –£–∂–∏–Ω
          </h3>
          <div class="space-y-3">
            @for (supplement of dinnerSupplements; track $index) {
              @let product = getProduct(supplement.productId);
              @if (product) {
                <label
                  class="flex items-start gap-3 p-3 rounded-lg border border-cream-300 hover:border-brand-400 cursor-pointer transition-all"
                  [class.bg-brand-50/30]="logForm.get('supplements')?.get(getSupplementControlName(supplement, $index))?.value"
                  [class.border-brand-500]="logForm.get('supplements')?.get(getSupplementControlName(supplement, $index))?.value"
                >
                  <!-- Checkbox -->
                  <input
                    type="checkbox"
                    [formControlName]="getSupplementControlName(supplement, $index)"
                    class="mt-1 h-5 w-5 rounded text-brand-600 focus:ring-brand-500 flex-shrink-0"
                  />
                  
                  <!-- Product Image -->
                  <img
                    [src]="imageService.getProductImage(product.imageURL || '', { width: 60, height: 60, quality: 85 })"
                    [alt]="product.name"
                    class="w-12 h-12 object-contain rounded-lg bg-white flex-shrink-0"
                  />
                  
                  <!-- Product Info -->
                  <div class="flex-grow min-w-0">
                    <div class="font-semibold text-cream-900">{{ product.name }}</div>
                    <div class="text-sm text-cream-700">
                      {{ supplement.amount }}
                      @if (supplement.notes) {
                        <span class="text-cream-600"> ¬∑ {{ supplement.notes }}</span>
                      }
                    </div>
                  </div>
                </label>
              }
            }
          </div>
        </div>
      }

      <!-- Empty State (if no supplements available) -->
      @if (morningSupplements.length === 0 && lunchSupplements.length === 0 && dinnerSupplements.length === 0) {
        <div class="text-center py-8 text-cream-600">
          <ng-icon name="heroInformationCircle" size="48" class="mx-auto mb-3" style="color: var(--color-cream-400)"></ng-icon>
          <p class="font-body">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–æ–±–∞–≤–æ–∫ –ø–æ–∫–∞ –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è —ç—Ç–æ–π –Ω–µ–¥–µ–ª–∏.</p>
        </div>
      }
    </div>

    <!-- Notes Section -->
    <div class="bg-white rounded-lg shadow-lg p-6">
      <label for="notes" class="block text-lg font-semibold text-cream-900 mb-3">–ó–∞–º–µ—Ç–∫–∏</label>
      <textarea
        id="notes"
        formControlName="notes"
        rows="4"
        class="w-full px-4 py-3 bg-cream-50 border border-cream-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-brand-500 text-cream-900"
        placeholder="–õ—é–±—ã–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏ –æ –ø–∏—Ç–∞–Ω–∏–∏, —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–∏ –∏ —Ç.–¥."
      ></textarea>
    </div>

    <!-- Submit Button -->
    <div class="text-center pb-6">
      <button
        type="submit"
        [disabled]="!logForm.valid"
        class="bg-brand-600 hover:bg-brand-700 text-white font-bold py-4 px-8 rounded-lg shadow-lg transition duration-300 ease-in-out disabled:bg-cream-400 disabled:cursor-not-allowed"
      >
        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –î–Ω–µ–≤–Ω–∏–∫
      </button>
    </div>
  </form>
</div>
